\documentclass[../thesis.tex]{subfiles}

\begin{document}

\section{Abstraktsed domeenid}

Andmevooanalüüsiga püütakse võimalikult täpselt määrata programmi seisundit igas programmi punktis.

\begin{definition}
\emph{Domeeniks} nimetatakse programmi kõikvõimalike seisundite hulka~\cite{vojdani_magister}.
\end{definition}

Selline informaalne definitsioon on ebapiisav mingisuguse teooria arendamiseks, mistõttu tegelikult vaadetakse domeene, mis moodustavad täieliku võre.

\subsection{Võred}

Kuigi võreteooria on arvestatav matemaatika haru, siis sügavamale laskumata on siin toodud põhilised mõisted võrede mõistmiseks.
Järgnevad eestikeelsed definitsioonid on refereeritud V. Laane loengukonspektist~\cite{laan_voreteooria}, kuid tähistused on kohandatud programmianalüüsi kirjandusele omaseks~\cite[17]{seidl_foundations}:

\begin{definition}
\emph{Osaliselt järjestatud hulk} on paar $(A, \sqleq)$, kus $A$ on hulk, millel on defineeritud binaarne seos $\sqleq$, mis iga $a, b, c \in A$ korral rahuldab järgnevaid tingimusi:
\begin{itemize}[nosep]
	\item $a \sqleq a$ (refleksiivsus),
	\item kui $a \sqleq b$ ja $b \sqleq c$, siis $a \sqleq c$ (transitiivsus),
	\item kui $a \sqleq b$ ja $b \sqleq a$, siis $a = b$ (antisümmeetrilisus).
\end{itemize}
\end{definition}

Olgu $(A, \sqleq)$ osaliselt järjestatud hulk ja $X \subseteq A$.

\begin{definition}
Elementi $c$ nimetatakse hulga $X$ \emph{ülemiseks tõkkeks}, kui iga $x \in X$ korral $x \sqleq c$. Vähimat ülemist tõket nimetatakse \emph{ülemiseks rajaks}, st $X$-i iga ülemise tõkke $d$ korral $c \sqleq d$.
\end{definition}

\begin{definition}
Elementi $c$ nimetatakse hulga $X$ \emph{alumiseks tõkkeks}, kui iga $x \in X$ korral $c \sqleq x$. Suurimat alumist tõket nimetatakse \emph{alumiseks rajaks}, st $X$-i iga alumise tõkke $d$ korral $d \sqleq c$.
\end{definition}

Hulga $X$ ülemist ja alumist raja tähistame vastavalt $\bigsqcup X$ ja $\bigsqcap X$. Kui $X = \{a, b\}$, siis tähistame ülemise ja alumise raja vastavalt $a \sqcup b$ ja $a \sqcap b$.

\begin{definition}
\emph{Täielik võre} on osaliselt järjestatud hulk, mille igal alamhulgal leidub ülemine ja alumine raja.
\end{definition}

Täielikus võres $(A, \sqleq)$ leidub vähim element $\bot = \bigsqcap A$ ja suurim element $\top = \bigsqcup A$, mida nimetatakse vastavalt \textit{bottom}iks ja \textit{top}iks.

\subsubsection{Motivatsioon}
Kui nõuda, et domeen oleks täielik võre, siis pole ilmselge, mis rolli täidab sellel vaadeldav järjestus ja rajad.

Seisundite hulga vaatlemiseks võrena on vaja defineerida seisundite osaline järjestus. Kokkuleppeliselt järjestatakse seisundid täpsemast ebatäpsema suunas --- kirjutis $a \sqleq b$ tähendab, et seisund $a$ on vähemalt sama täpne kui seisund $b$ ning $b$ on vähemalt sama üldine kui $a$. Seega $\top$ tähistab kõige ebatäpsemat seisundit.

Sellise järjestuse korral seisundite ülemine raja kujutab endast nende seisundite ühendamist.
\TODO{\textit{join}i intuitsioon}


\subsection{Potentshulga domeen}
\TODO{\textit{powerset} = potentshulk?}

Iga hulga $S$ korral saab vaadelda selle kõigi alamhulkade hulka $\powerset{S}$, millel on loomulik osaline järjestus $\subseteq$.
Osutub, et see on ka täielik võre, kus
\begin{itemize}[nosep]
	\item $a \sqleq b \Leftrightarrow a \subseteq b$,
	\item $a \sqcup b = a \cup b$ ja $a \sqcap b = a \cap b$,
	\item $\bot = \emptyset$ ja $\top = S$.
\end{itemize}

\begin{figure}
	\centering
	\begin{subfigure}[b]{0.4\textwidth}
		\centering
		\begin{minted}{c}
		int x;
		if (rand() % 2 == 0)
			x = 5;
		else
			x = 3;
		int y = x + 1;
		\end{minted}
		\caption{C-keelne lähtekood}
	\end{subfigure}
	~
	\begin{subfigure}[b]{0.4\textwidth}
		\centering
		\begin{tikzpicture}[
			->,>=stealth,
			node distance=0.5cm,
			every state/.style={inner sep=3pt, minimum size=0pt},
			stmt/.style={font=\ttfamily},
			initial text={},
			initial where=above
		]
			\node[initial,state] (1) {1};
			\node[state] (2) [below left=of 1] {2};
			\node[state] (3) [below right=of 1] {3};
			\node[state] (4) [below=of 2] {4};
			\node[state] (5) [below=of 3] {5};
			\node[state] (6) [below right=of 4] {6};
			\node[accepting,state] (7) [below=of 6] {7};

			\path
				(1) edge node[stmt,above left] {rand() \% 2 == 0} (2)
				    edge node[stmt,above right] {rand() \% 2 != 0} (3)
				(2) edge node[stmt,left] {x = 5} (4)
				(3) edge node[stmt,right] {x = 3} (5)
				(4) edge node {} (6)
				(5) edge node {} (6)
				(6) edge node[stmt,right] {y = x + 1} (7);
		\end{tikzpicture}
		\TODO{programmi laused tippudes või servades?}
		\caption{Juhtimisvoograaf}
	\end{subfigure}

	\caption{Tsüklita programmi näidis}
	\label{lst:if}
\end{figure}

Olgu vaatluse all programm jooniselt~\ref{lst:if}.
\TODO{CFG valmis teha enne kui sellest saab rääkida}


\subsection{Intervalldomeen}
Intervalldomeen on domeen, milles täisarvude väärtuste abstraheerimiseks kasutatakse arvtelje lõike.

\begin{definition}
\emph{Intervalldomeeniks}~\cite[55]{seidl_foundations} nimetatakse hulka
\[
	\mathbb{I} = \{ [l, u] \mid l \in \mathbb{Z} \cup \{-\infty\}, u \in \mathbb{Z} \cup \{+\infty\}, l \leq u \},
\]
millel on osaline järjestus
\[
	[l_1, u_1] \sqleq [l_2, u_2] \quad\Longleftrightarrow\quad l_2 \leq l_1 \land u_1 \leq u_2.
\]
\end{definition}

\TODO{$\mathbb{I}$ pole täielik võre! vaja eraldi võre definitsiooni?}


\end{document}